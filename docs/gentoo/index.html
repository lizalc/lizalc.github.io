
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://liz.ac/gentoo/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Gentoo Notes - Liza Chevalier</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gentoo-notes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Liza Chevalier" class="md-header__button md-logo" aria-label="Liza Chevalier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Liza Chevalier
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gentoo Notes
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lizalc/lizalc.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lizalc.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Hello!
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Gentoo Notes
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Liza Chevalier" class="md-nav__button md-logo" aria-label="Liza Chevalier" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Liza Chevalier
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lizalc/lizalc.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    lizalc.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Hello!
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Gentoo Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Gentoo Notes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fedora-pre-installation" class="md-nav__link">
    Fedora Pre-Installation
  </a>
  
    <nav class="md-nav" aria-label="Fedora Pre-Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disk-setup" class="md-nav__link">
    Disk setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disk-layout" class="md-nav__link">
    Disk Layout
  </a>
  
    <nav class="md-nav" aria-label="Disk Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fstab-modifications" class="md-nav__link">
    fstab Modifications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zram-portage-workdir" class="md-nav__link">
    ZRAM Portage WORKDIR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fedora-post-installation" class="md-nav__link">
    Fedora Post-Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepping-the-gentoo-install" class="md-nav__link">
    Prepping the Gentoo Install
  </a>
  
    <nav class="md-nav" aria-label="Prepping the Gentoo Install">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gentoo-mounts" class="md-nav__link">
    Gentoo Mounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ebuild-repository" class="md-nav__link">
    Ebuild Repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gentoo-installation" class="md-nav__link">
    Gentoo Installation
  </a>
  
    <nav class="md-nav" aria-label="Gentoo Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stage3-selection" class="md-nav__link">
    stage3 Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usr-merge" class="md-nav__link">
    /usr Merge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-the-gentoo-base-system" class="md-nav__link">
    Installing the Gentoo Base System
  </a>
  
    <nav class="md-nav" aria-label="Installing the Gentoo Base System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#systemd-nspawn" class="md-nav__link">
    systemd-nspawn
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-boot" class="md-nav__link">
    systemd-boot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gentoo-configuration" class="md-nav__link">
    Gentoo Configuration
  </a>
  
    <nav class="md-nav" aria-label="Gentoo Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-configuration" class="md-nav__link">
    Important Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/lizalc/lizalc.github.io/edit/main/src/doc/gentoo.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="gentoo-notes">Gentoo Notes<a class="headerlink" href="#gentoo-notes" title="Permanent link">&para;</a></h1>
<p>These are notes covering Gentoo installation and configuration. Primarily to
have something documented for myself.</p>
<p>Preferred Gentoo configuration is:</p>
<ul>
<li>systemd</li>
<li>no multilib</li>
<li>gnome</li>
<li>no split /usr</li>
<li><a href="https://leo3418.github.io/2021/01/16/gentoo-merge-usr.html">ref</a></li>
</ul>
<h2 id="fedora-pre-installation">Fedora Pre-Installation<a class="headerlink" href="#fedora-pre-installation" title="Permanent link">&para;</a></h2>
<p>Prior to installing Gentoo the latest Fedora should be installed and brought up
to date. Default installation options are fine as long as the installation
provides the following:</p>
<ul>
<li>btrfs root</li>
<li>Fedora installs to subvolume by default</li>
<li>UEFI boot partition (ESP)</li>
<li>Mounted at <code>/boot/efi</code></li>
<li><code>/boot</code> is not a separate partition, though may be its own subvolume.</li>
<li>GUI environment</li>
<li>Working network</li>
<li>Working mouse (bluetooth, etc)</li>
</ul>
<p>Generally nothing special is required for this. Just click through the
installer.</p>
<h3 id="disk-setup">Disk setup<a class="headerlink" href="#disk-setup" title="Permanent link">&para;</a></h3>
<p>Current disk setup is two NVMe drives in RAID0. When installing Fedora the disk
setup steps should be checked to ensure the <code>RAID0</code> profile is used.</p>
<h3 id="disk-layout">Disk Layout<a class="headerlink" href="#disk-layout" title="Permanent link">&para;</a></h3>
<p>Remember, <code>/boot/efi</code> / <code>/efi</code> is the only other non-btrfs partition. The
following table shows the layout setup during a Fedora install.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Mountpoint</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fedora</td>
<td>/</td>
<td><code>btrfs</code> subvolume</td>
<td></td>
</tr>
<tr>
<td>Gentoo</td>
<td>/mnt/gentoo</td>
<td><code>btrfs</code> subvolume</td>
<td></td>
</tr>
<tr>
<td>home</td>
<td>/home</td>
<td><code>btrfs</code> subvolume</td>
<td></td>
</tr>
<tr>
<td>boot</td>
<td>/boot</td>
<td><code>btrfs</code> subvolume</td>
<td></td>
</tr>
<tr>
<td>ESP</td>
<td>/boot/efi</td>
<td>EFI partition</td>
<td><code>/efi</code> on Gentoo</td>
</tr>
<tr>
<td>Misc</td>
<td>Anything</td>
<td>LVM misc space</td>
<td>Useful for static backups</td>
</tr>
<tr>
<td>portage</td>
<td>/mnt/gentoo/var/tmp/portage</td>
<td>ZRAM</td>
<td>Keeps portage workdir in memory rather than on disk</td>
</tr>
</tbody>
</table>
<p>The <code>Misc</code> space is leftover free space + (2 * RAM size). Used for swap or
whatever else that would benefit from not being in a <code>btrfs</code> subvolume.</p>
<h4 id="fstab-modifications"><code>fstab</code> Modifications<a class="headerlink" href="#fstab-modifications" title="Permanent link">&para;</a></h4>
<p>The <code>btrfs</code> mount options in the Fedora <code>/etc/fstab</code> should be updated to change
<code>compress</code> to <code>compress-force</code>. Just so <code>btrfs</code> compression is configured as desired from
the start.</p>
<h4 id="zram-portage-workdir">ZRAM Portage WORKDIR<a class="headerlink" href="#zram-portage-workdir" title="Permanent link">&para;</a></h4>
<p>The ZRAM device needs to be manually set up using <a href="https://github.com/systemd/zram-generator"><code>zram-generator</code></a>.</p>
<h2 id="fedora-post-installation">Fedora Post-Installation<a class="headerlink" href="#fedora-post-installation" title="Permanent link">&para;</a></h2>
<p>The default user account is not intended for sharing with Gentoo, at least until
Fedora better supports <code>systemd-homed</code>. Therefore the new user created on first
boot should be Fedora specific. The Fedora account is secondary to the Gentoo
account.</p>
<p>Ensure Fedora is brought up to date and that time is synced and correct. Additional
config may also be taken to make the environment more comfortable, such as setting up
Neovim and ZSH.</p>
<h2 id="prepping-the-gentoo-install">Prepping the Gentoo Install<a class="headerlink" href="#prepping-the-gentoo-install" title="Permanent link">&para;</a></h2>
<p>With a working Fedora environment the Gentoo installation can proceed. This will
mostly follow the <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64">Gentoo Handbook</a>
with deviations made for <code>systemd</code> usage. For example, right off the bat <code>systemd-nspawn</code>
should be used instead of <code>chroot</code> (<a href="https://rich0gentoo.wordpress.com/2014/07/14/quick-systemd-nspawn-guide/">ref1</a>, <a href="https://github.com/cyber-duk/Gentoo-Systemd-Install-Guide">ref2</a>).</p>
<h3 id="gentoo-mounts">Gentoo Mounts<a class="headerlink" href="#gentoo-mounts" title="Permanent link">&para;</a></h3>
<p>Ensure the <code>ESP</code> has been mounted to <code>/mnt/gentoo/efi</code>. Aside from this everything else
should be ready to go provided everything has been set up as described in the
<a href="#disk-layout">Disk Layout</a> table.</p>
<h3 id="ebuild-repository">Ebuild Repository<a class="headerlink" href="#ebuild-repository" title="Permanent link">&para;</a></h3>
<p>Ebuild repository should be set up <em>after</em> the <code>stage3</code> has been extracted.</p>
<p>This is just to skip using <code>emerge-webrsync</code> for an initial Gentoo ebuild repository. As
<code>git</code> is not available in the <code>stage3</code> by default the Gentoo repository should be cloned
to <code>/mnt/gentoo/var/db/repos/gentoo</code> from Fedora. This way Portage can be configured to
sync over <code>git</code> from the start.</p>
<h2 id="gentoo-installation">Gentoo Installation<a class="headerlink" href="#gentoo-installation" title="Permanent link">&para;</a></h2>
<p>It is highly recommended to perform the Gentoo installation inside of <code>screen</code> so the
installation isn't interrupted by closing the terminal / SSH connection.</p>
<p>With the pre-installation environment ready to go the Gentoo install process may begin,
starting with the <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Stage#Downloading_the_stage_tarball">Downloading the stage tarball</a>
section.</p>
<h3 id="stage3-selection"><code>stage3</code> Selection<a class="headerlink" href="#stage3-selection" title="Permanent link">&para;</a></h3>
<p>Download and verify the current <code>stage3-amd64-nomultilib-systemd</code> tarball.</p>
<h3 id="usr-merge"><code>/usr</code> Merge<a class="headerlink" href="#usr-merge" title="Permanent link">&para;</a></h3>
<p>After the <code>stage3</code> has been extracted the steps to perform the <code>/usr</code> merge should be
taken. The instructions for performing this are here: <a href="https://leo3418.github.io/2021/01/16/gentoo-merge-usr.html"><code>/usr</code> merge steps</a></p>
<p>Follow the instructions for the <code>/usr</code> merge that configures it in the way <code>baselayout</code>
expects (the second form of the merge). Note that this involves a step before entering
the Gentoo environment and a step after entering the Gentoo environment.</p>
<h3 id="installing-the-gentoo-base-system"><a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Base">Installing the Gentoo Base System</a><a class="headerlink" href="#installing-the-gentoo-base-system" title="Permanent link">&para;</a></h3>
<p>Prior to doing any steps listed in the official handbook the Gentoo ebuild <code>git</code>
repository should be set up in <code>/mnt/gentoo/var/db/repos/gentoo</code> and the repository
<code>.conf</code> configured for <code>git</code> instead of <code>rsync</code>. The <a href="https://wiki.gentoo.org/wiki/Project:GURU">GURU</a>
repository may also be added and configured.</p>
<h4 id="systemd-nspawn"><code>systemd-nspawn</code><a class="headerlink" href="#systemd-nspawn" title="Permanent link">&para;</a></h4>
<p>To allow login the <code>root</code> password in the Gentoo environment should be removed. This can
be accomplished via:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sed -i -e <span class="s1">&#39;s/^root:\*/root:/&#39;</span> /mnt/gentoo/etc/shadow
</code></pre></div>
<p>As mentioned previously <code>chroot</code> will not be used here. Instead <code>systemd-nspawn</code> will be
used so <code>systemd</code> can be active in the Gentoo environment. <code>chroot</code> setup may be ignored
and the Gentoo environment can be entered via:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>systemd-nspawn -D /mnt/gentoo -j -b
</code></pre></div>
<h3 id="systemd-boot"><code>systemd-boot</code><a class="headerlink" href="#systemd-boot" title="Permanent link">&para;</a></h3>
<!-- TODO -->

<h2 id="gentoo-configuration">Gentoo Configuration<a class="headerlink" href="#gentoo-configuration" title="Permanent link">&para;</a></h2>
<!-- TODO -->

<h3 id="important-configuration">Important Configuration<a class="headerlink" href="#important-configuration" title="Permanent link">&para;</a></h3>
<p>These files should likely be backup up in a git repo, sans things containing private keys.</p>
<ul>
<li><code>/etc/portage</code></li>
<li><code>/etc/containers</code></li>
<li>for <code>podman</code></li>
<li><code>/etc/dracut.conf.d</code></li>
<li>for initramfs</li>
<li><code>/etc/efikeys</code></li>
<li>for custom secureboot keys</li>
<li><code>/etc/fstab</code></li>
<li><code>/etc/kernel</code></li>
<li>config overrides</li>
<li>helper scripts (signing, etc)</li>
<li><code>/etc/secureboot</code></li>
<li>copy of <code>efikeys</code></li>
<li><code>/etc/systemd/zram-generator.conf</code></li>
<li>For <code>/var/tmp/portage</code> ramdisk</li>
<li>Possibly swap too</li>
<li><code>/etc/polkit-1/rules.d/49-wheel.rules</code><ul>
<li>From https://leo3418.github.io/2021/04/24/gentoo-config-gnome-systemd.html#allow-users-in-wheel-group-to-use-their-own-credentials-for-authentication-in-gnome</li>
</ul>
</li>
</ul>
<p><code>/var/lib/portage/world</code> contains the set of installed packages. Could be good to keep
this backed up as well.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 4, 2022</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 4, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Hello!" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Hello!
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.share", "search.suggest", "toc.integrate"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>