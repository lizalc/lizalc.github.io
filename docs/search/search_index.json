{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Hello! \u00b6 There isn't much here at the moment.","title":"Hello!"},{"location":"#hello","text":"There isn't much here at the moment.","title":"Hello!"},{"location":"gentoo/","text":"Gentoo Notes \u00b6 These are notes covering Gentoo installation and configuration. Primarily to have something documented for myself. Preferred Gentoo configuration is: systemd no multilib gnome no split /usr ref Fedora Pre-Installation \u00b6 Prior to installing Gentoo the latest Fedora should be installed and brought up to date. Default installation options are fine as long as the installation provides the following: btrfs root Fedora installs to subvolume by default UEFI boot partition (ESP) Mounted at /boot/efi /boot is not a separate partition, though may be its own subvolume. GUI environment Working network Working mouse (bluetooth, etc) Generally nothing special is required for this. Just click through the installer. Disk setup \u00b6 Current disk setup is two NVMe drives in RAID0. When installing Fedora the disk setup steps should be checked to ensure the RAID0 profile is used. Disk Layout \u00b6 Remember, /boot/efi / /efi is the only other non-btrfs partition. The following table shows the layout setup during a Fedora install. Name Mountpoint Type Notes Fedora / btrfs subvolume Gentoo /mnt/gentoo btrfs subvolume home /home btrfs subvolume boot /boot btrfs subvolume ESP /boot/efi EFI partition /efi on Gentoo Misc Anything LVM misc space Useful for static backups portage /mnt/gentoo/var/tmp/portage ZRAM Keeps portage workdir in memory rather than on disk The Misc space is leftover free space + (2 * RAM size). Used for swap or whatever else that would benefit from not being in a btrfs subvolume. fstab Modifications \u00b6 The btrfs mount options in the Fedora /etc/fstab should be updated to change compress to compress-force . Just so btrfs compression is configured as desired from the start. ZRAM Portage WORKDIR \u00b6 The ZRAM device needs to be manually set up using zram-generator . Fedora Post-Installation \u00b6 The default user account is not intended for sharing with Gentoo, at least until Fedora better supports systemd-homed . Therefore the new user created on first boot should be Fedora specific. The Fedora account is secondary to the Gentoo account. Ensure Fedora is brought up to date and that time is synced and correct. Additional config may also be taken to make the environment more comfortable, such as setting up Neovim and ZSH. Prepping the Gentoo Install \u00b6 With a working Fedora environment the Gentoo installation can proceed. This will mostly follow the Gentoo Handbook with deviations made for systemd usage. For example, right off the bat systemd-nspawn should be used instead of chroot ( ref1 , ref2 ). Gentoo Mounts \u00b6 Ensure the ESP has been mounted to /mnt/gentoo/efi . Aside from this everything else should be ready to go provided everything has been set up as described in the Disk Layout table. Ebuild Repository \u00b6 Ebuild repository should be set up after the stage3 has been extracted. This is just to skip using emerge-webrsync for an initial Gentoo ebuild repository. As git is not available in the stage3 by default the Gentoo repository should be cloned to /mnt/gentoo/var/db/repos/gentoo from Fedora. This way Portage can be configured to sync over git from the start. Gentoo Installation \u00b6 It is highly recommended to perform the Gentoo installation inside of screen so the installation isn't interrupted by closing the terminal / SSH connection. With the pre-installation environment ready to go the Gentoo install process may begin, starting with the Downloading the stage tarball section. stage3 Selection \u00b6 Download and verify the current stage3-amd64-nomultilib-systemd tarball. /usr Merge \u00b6 After the stage3 has been extracted the steps to perform the /usr merge should be taken. The instructions for performing this are here: /usr merge steps Follow the instructions for the /usr merge that configures it in the way baselayout expects (the second form of the merge). Note that this involves a step before entering the Gentoo environment and a step after entering the Gentoo environment. Installing the Gentoo Base System \u00b6 Prior to doing any steps listed in the official handbook the Gentoo ebuild git repository should be set up in /mnt/gentoo/var/db/repos/gentoo and the repository .conf configured for git instead of rsync . The GURU repository may also be added and configured. systemd-nspawn \u00b6 To allow login the root password in the Gentoo environment should be removed. This can be accomplished via: sed -i -e 's/^root:\\*/root:/' /mnt/gentoo/etc/shadow As mentioned previously chroot will not be used here. Instead systemd-nspawn will be used so systemd can be active in the Gentoo environment. chroot setup may be ignored and the Gentoo environment can be entered via: systemd-nspawn -D /mnt/gentoo -j -b systemd-boot \u00b6 Gentoo Configuration \u00b6 Important Configuration \u00b6 These files should likely be backup up in a git repo, sans things containing private keys. /etc/portage /etc/containers for podman /etc/dracut.conf.d for initramfs /etc/efikeys for custom secureboot keys /etc/fstab /etc/kernel config overrides helper scripts (signing, etc) /etc/secureboot copy of efikeys /etc/systemd/zram-generator.conf For /var/tmp/portage ramdisk Possibly swap too /etc/polkit-1/rules.d/49-wheel.rules From https://leo3418.github.io/2021/04/24/gentoo-config-gnome-systemd.html#allow-users-in-wheel-group-to-use-their-own-credentials-for-authentication-in-gnome /var/lib/portage/world contains the set of installed packages. Could be good to keep this backed up as well.","title":"Gentoo Notes"},{"location":"gentoo/#gentoo-notes","text":"These are notes covering Gentoo installation and configuration. Primarily to have something documented for myself. Preferred Gentoo configuration is: systemd no multilib gnome no split /usr ref","title":"Gentoo Notes"},{"location":"gentoo/#fedora-pre-installation","text":"Prior to installing Gentoo the latest Fedora should be installed and brought up to date. Default installation options are fine as long as the installation provides the following: btrfs root Fedora installs to subvolume by default UEFI boot partition (ESP) Mounted at /boot/efi /boot is not a separate partition, though may be its own subvolume. GUI environment Working network Working mouse (bluetooth, etc) Generally nothing special is required for this. Just click through the installer.","title":"Fedora Pre-Installation"},{"location":"gentoo/#disk-setup","text":"Current disk setup is two NVMe drives in RAID0. When installing Fedora the disk setup steps should be checked to ensure the RAID0 profile is used.","title":"Disk setup"},{"location":"gentoo/#disk-layout","text":"Remember, /boot/efi / /efi is the only other non-btrfs partition. The following table shows the layout setup during a Fedora install. Name Mountpoint Type Notes Fedora / btrfs subvolume Gentoo /mnt/gentoo btrfs subvolume home /home btrfs subvolume boot /boot btrfs subvolume ESP /boot/efi EFI partition /efi on Gentoo Misc Anything LVM misc space Useful for static backups portage /mnt/gentoo/var/tmp/portage ZRAM Keeps portage workdir in memory rather than on disk The Misc space is leftover free space + (2 * RAM size). Used for swap or whatever else that would benefit from not being in a btrfs subvolume.","title":"Disk Layout"},{"location":"gentoo/#fstab-modifications","text":"The btrfs mount options in the Fedora /etc/fstab should be updated to change compress to compress-force . Just so btrfs compression is configured as desired from the start.","title":"fstab Modifications"},{"location":"gentoo/#zram-portage-workdir","text":"The ZRAM device needs to be manually set up using zram-generator .","title":"ZRAM Portage WORKDIR"},{"location":"gentoo/#fedora-post-installation","text":"The default user account is not intended for sharing with Gentoo, at least until Fedora better supports systemd-homed . Therefore the new user created on first boot should be Fedora specific. The Fedora account is secondary to the Gentoo account. Ensure Fedora is brought up to date and that time is synced and correct. Additional config may also be taken to make the environment more comfortable, such as setting up Neovim and ZSH.","title":"Fedora Post-Installation"},{"location":"gentoo/#prepping-the-gentoo-install","text":"With a working Fedora environment the Gentoo installation can proceed. This will mostly follow the Gentoo Handbook with deviations made for systemd usage. For example, right off the bat systemd-nspawn should be used instead of chroot ( ref1 , ref2 ).","title":"Prepping the Gentoo Install"},{"location":"gentoo/#gentoo-mounts","text":"Ensure the ESP has been mounted to /mnt/gentoo/efi . Aside from this everything else should be ready to go provided everything has been set up as described in the Disk Layout table.","title":"Gentoo Mounts"},{"location":"gentoo/#ebuild-repository","text":"Ebuild repository should be set up after the stage3 has been extracted. This is just to skip using emerge-webrsync for an initial Gentoo ebuild repository. As git is not available in the stage3 by default the Gentoo repository should be cloned to /mnt/gentoo/var/db/repos/gentoo from Fedora. This way Portage can be configured to sync over git from the start.","title":"Ebuild Repository"},{"location":"gentoo/#gentoo-installation","text":"It is highly recommended to perform the Gentoo installation inside of screen so the installation isn't interrupted by closing the terminal / SSH connection. With the pre-installation environment ready to go the Gentoo install process may begin, starting with the Downloading the stage tarball section.","title":"Gentoo Installation"},{"location":"gentoo/#stage3-selection","text":"Download and verify the current stage3-amd64-nomultilib-systemd tarball.","title":"stage3 Selection"},{"location":"gentoo/#usr-merge","text":"After the stage3 has been extracted the steps to perform the /usr merge should be taken. The instructions for performing this are here: /usr merge steps Follow the instructions for the /usr merge that configures it in the way baselayout expects (the second form of the merge). Note that this involves a step before entering the Gentoo environment and a step after entering the Gentoo environment.","title":"/usr Merge"},{"location":"gentoo/#installing-the-gentoo-base-system","text":"Prior to doing any steps listed in the official handbook the Gentoo ebuild git repository should be set up in /mnt/gentoo/var/db/repos/gentoo and the repository .conf configured for git instead of rsync . The GURU repository may also be added and configured.","title":"Installing the Gentoo Base System"},{"location":"gentoo/#systemd-nspawn","text":"To allow login the root password in the Gentoo environment should be removed. This can be accomplished via: sed -i -e 's/^root:\\*/root:/' /mnt/gentoo/etc/shadow As mentioned previously chroot will not be used here. Instead systemd-nspawn will be used so systemd can be active in the Gentoo environment. chroot setup may be ignored and the Gentoo environment can be entered via: systemd-nspawn -D /mnt/gentoo -j -b","title":"systemd-nspawn"},{"location":"gentoo/#systemd-boot","text":"","title":"systemd-boot"},{"location":"gentoo/#gentoo-configuration","text":"","title":"Gentoo Configuration"},{"location":"gentoo/#important-configuration","text":"These files should likely be backup up in a git repo, sans things containing private keys. /etc/portage /etc/containers for podman /etc/dracut.conf.d for initramfs /etc/efikeys for custom secureboot keys /etc/fstab /etc/kernel config overrides helper scripts (signing, etc) /etc/secureboot copy of efikeys /etc/systemd/zram-generator.conf For /var/tmp/portage ramdisk Possibly swap too /etc/polkit-1/rules.d/49-wheel.rules From https://leo3418.github.io/2021/04/24/gentoo-config-gnome-systemd.html#allow-users-in-wheel-group-to-use-their-own-credentials-for-authentication-in-gnome /var/lib/portage/world contains the set of installed packages. Could be good to keep this backed up as well.","title":"Important Configuration"}]}