{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Hello!","text":"<p>There isn't much here at the moment. </p>"},{"location":"gentoo/","title":"Gentoo Notes","text":"<p>These are notes covering Gentoo installation and configuration. Primarily to have something documented for myself.</p> <p>Preferred Gentoo configuration is:</p> <ul> <li>systemd</li> <li>no multilib</li> <li>gnome</li> <li>no split /usr<ul> <li>ref</li> </ul> </li> </ul>"},{"location":"gentoo/#fedora-pre-installation","title":"Fedora Pre-Installation","text":"<p>Prior to installing Gentoo the latest Fedora should be installed and brought up to date. Default installation options are fine as long as the installation provides the following:</p> <ul> <li>btrfs root<ul> <li>Fedora installs to subvolume by default</li> </ul> </li> <li>UEFI boot partition (ESP)<ul> <li>Mounted at <code>/boot/efi</code></li> <li><code>/boot</code> is not a separate partition, though may be its own subvolume.</li> </ul> </li> <li>GUI environment</li> <li>Working network</li> <li>Working mouse (bluetooth, etc)</li> </ul> <p>Generally nothing special is required for this. Just click through the installer.</p>"},{"location":"gentoo/#disk-setup","title":"Disk setup","text":"<p>Current disk setup is two NVMe drives in RAID0. When installing Fedora the disk setup steps should be checked to ensure the <code>RAID0</code> profile is used.</p>"},{"location":"gentoo/#disk-layout","title":"Disk Layout","text":"<p>Remember, <code>/boot/efi</code> / <code>/efi</code> is the only other non-btrfs partition. The following table shows the layout setup during a Fedora install.</p> Name Mountpoint Type Notes Fedora / <code>btrfs</code> subvolume Gentoo /mnt/gentoo <code>btrfs</code> subvolume home /home <code>btrfs</code> subvolume boot /boot <code>btrfs</code> subvolume ESP /boot/efi EFI partition <code>/efi</code> on Gentoo Misc Anything LVM misc space Useful for static backups portage /mnt/gentoo/var/tmp/portage ZRAM Keeps portage workdir in memory rather than on disk <p>The <code>Misc</code> space is leftover free space + (2 * RAM size). Used for swap or whatever else that would benefit from not being in a <code>btrfs</code> subvolume.</p>"},{"location":"gentoo/#fstab-modifications","title":"<code>fstab</code> Modifications","text":"<p>The <code>btrfs</code> mount options in the Fedora <code>/etc/fstab</code> should be updated to change <code>compress</code> to <code>compress-force</code>. Just so <code>btrfs</code> compression is configured as desired from the start.</p>"},{"location":"gentoo/#zram-portage-workdir","title":"ZRAM Portage WORKDIR","text":"<p>The ZRAM device needs to be manually set up using <code>zram-generator</code>.</p>"},{"location":"gentoo/#fedora-post-installation","title":"Fedora Post-Installation","text":"<p>The default user account is not intended for sharing with Gentoo, at least until Fedora better supports <code>systemd-homed</code>. Therefore the new user created on first boot should be Fedora specific. The Fedora account is secondary to the Gentoo account.</p> <p>Ensure Fedora is brought up to date and that time is synced and correct. Additional config may also be taken to make the environment more comfortable, such as setting up Neovim and ZSH.</p>"},{"location":"gentoo/#prepping-the-gentoo-install","title":"Prepping the Gentoo Install","text":"<p>With a working Fedora environment the Gentoo installation can proceed. This will mostly follow the Gentoo Handbook with deviations made for <code>systemd</code> usage. For example, right off the bat <code>systemd-nspawn</code> should be used instead of <code>chroot</code> (ref1, ref2).</p>"},{"location":"gentoo/#gentoo-mounts","title":"Gentoo Mounts","text":"<p>Ensure the <code>ESP</code> has been mounted to <code>/mnt/gentoo/efi</code>. Aside from this everything else should be ready to go provided everything has been set up as described in the Disk Layout table.</p>"},{"location":"gentoo/#ebuild-repository","title":"Ebuild Repository","text":"<p>Ebuild repository should be set up after the <code>stage3</code> has been extracted.</p> <p>This is just to skip using <code>emerge-webrsync</code> for an initial Gentoo ebuild repository. As <code>git</code> is not available in the <code>stage3</code> by default the Gentoo repository should be cloned to <code>/mnt/gentoo/var/db/repos/gentoo</code> from Fedora. This way Portage can be configured to sync over <code>git</code> from the start.</p>"},{"location":"gentoo/#gentoo-installation","title":"Gentoo Installation","text":"<p>It is highly recommended to perform the Gentoo installation inside of <code>screen</code> so the installation isn't interrupted by closing the terminal / SSH connection.</p> <p>With the pre-installation environment ready to go the Gentoo install process may begin, starting with the Downloading the stage tarball section.</p>"},{"location":"gentoo/#stage3-selection","title":"<code>stage3</code> Selection","text":"<p>Download and verify the current <code>stage3-amd64-nomultilib-systemd</code> tarball.</p>"},{"location":"gentoo/#usr-merge","title":"<code>/usr</code> Merge","text":"<p>After the <code>stage3</code> has been extracted the steps to perform the <code>/usr</code> merge should be taken. The instructions for performing this are here: <code>/usr</code> merge steps</p> <p>Follow the instructions for the <code>/usr</code> merge that configures it in the way <code>baselayout</code> expects (the second form of the merge). Note that this involves a step before entering the Gentoo environment and a step after entering the Gentoo environment.</p>"},{"location":"gentoo/#installing-the-gentoo-base-system","title":"Installing the Gentoo Base System","text":"<p>Prior to doing any steps listed in the official handbook the Gentoo ebuild <code>git</code> repository should be set up in <code>/mnt/gentoo/var/db/repos/gentoo</code> and the repository <code>.conf</code> configured for <code>git</code> instead of <code>rsync</code>. The GURU repository may also be added and configured.</p>"},{"location":"gentoo/#systemd-nspawn","title":"<code>systemd-nspawn</code>","text":"<p>To allow login the <code>root</code> password in the Gentoo environment should be removed. This can be accomplished via:</p> <pre><code>sed -i -e 's/^root:\\*/root:/' /mnt/gentoo/etc/shadow\n</code></pre> <p>As mentioned previously <code>chroot</code> will not be used here. Instead <code>systemd-nspawn</code> will be used so <code>systemd</code> can be active in the Gentoo environment. <code>chroot</code> setup may be ignored and the Gentoo environment can be entered via:</p> <pre><code>systemd-nspawn -D /mnt/gentoo -j -b\n</code></pre>"},{"location":"gentoo/#systemd-boot","title":"<code>systemd-boot</code>","text":""},{"location":"gentoo/#gentoo-configuration","title":"Gentoo Configuration","text":""},{"location":"gentoo/#important-configuration","title":"Important Configuration","text":"<p>These files should likely be backup up in a git repo, sans things containing private keys.</p> <ul> <li><code>/etc/portage</code></li> <li><code>/etc/containers</code><ul> <li>for <code>podman</code></li> </ul> </li> <li><code>/etc/dracut.conf.d</code><ul> <li>for initramfs</li> </ul> </li> <li><code>/etc/efikeys</code><ul> <li>for custom secureboot keys</li> </ul> </li> <li><code>/etc/fstab</code></li> <li><code>/etc/kernel</code><ul> <li>config overrides</li> <li>helper scripts (signing, etc)</li> </ul> </li> <li><code>/etc/secureboot</code><ul> <li>copy of <code>efikeys</code></li> </ul> </li> <li><code>/etc/systemd/zram-generator.conf</code><ul> <li>For <code>/var/tmp/portage</code> ramdisk</li> <li>Possibly swap too</li> </ul> </li> <li><code>/etc/polkit-1/rules.d/49-wheel.rules</code><ul> <li>From https://leo3418.github.io/2021/04/24/gentoo-config-gnome-systemd.html#allow-users-in-wheel-group-to-use-their-own-credentials-for-authentication-in-gnome</li> </ul> </li> </ul> <p><code>/var/lib/portage/world</code> contains the set of installed packages. Could be good to keep this backed up as well.</p>"},{"location":"Policies/emc.ui-privacy-policy/","title":"<code>Emc.UI</code> Privacy Policy","text":"<p><code>Emc.UI</code> does not collect or use any user data.</p>"}]}